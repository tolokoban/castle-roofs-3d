require("mover",function(t,i){function s(t){"undefined"==typeof t&&(t={}),"undefined"==typeof t.durTranslate&&(t.durTranslate=500),"undefined"==typeof t.durRotate&&(t.durRotate=700),"undefined"==typeof t.col&&(t.col=0),"undefined"==typeof t.row&&(t.row=0),this._durTranslate=t.durTranslate,this._durRotate=t.durRotate,this._mesh=t.mesh,this._castle=t.castle,this._action=null,this._rot=this._angle=0,this._x=t.castle.col2x(t.col),this._y=t.castle.getHeight(t.col,t.row),this._z=t.castle.row2z(t.row),this._miniJump=0}function o(t){var i=this._castle,s=e[this._rot],o=this.getCol(),h=this.getRow(),n=i.getHeight(o,h),_=o+s[0],r=h+s[1],a=i.getHeight(_,r);if(!(Math.abs(a-n)>.33)){var c=this._x,l=this._y,u=this._z,p=i.col2x(_),f=a,d=i.row2z(r);this._miniJump=Math.abs(f-l),this._miniJump>.001&&(this._miniJump+=.1);var x=function(i){i-=t,i>this._durTranslate?(this._action=null,this._x=p,this._y=f,this._z=d):(i/=this._durTranslate,this._x=c*(1-i)+p*i,this._y=l*(1-i)+f*i+this._miniJump*Math.sin(Math.PI*i),this._z=u*(1-i)+d*i)};this._action=x.bind(this)}}function h(t){var i=function(i){i-=t,i>this._durRotate?(this._action=null,this._rot=(this._rot+1)%4,this._angle=-this._rot*Math.PI/2):(i/=this._durRotate,this._angle=-(this._rot+i)*Math.PI/2)};this._action=i.bind(this)}function n(t){var i=function(i){i-=t,i>this._durRotate?(this._action=null,this._rot=(this._rot+3)%4,this._angle=-this._rot*Math.PI/2):(i/=this._durRotate,this._angle=-(this._rot-i)*Math.PI/2)};this._action=i.bind(this)}var e=[[1,0],[0,1],[-1,0],[0,-1]];s.prototype.getDir=function(){return e[this._rot]},s.prototype.getPos=function(){return{x:this._x,y:this._y,z:this._z}},s.prototype.move=function(t){if(this._action)this._action(t);else if(this._nextAction){var i=this._nextAction.id;"teleport"==i?(this._x=this._nextAction.x,this._y=this._nextAction.y,this._z=this._nextAction.z):"forward"==i?o.call(this,t):"right"==i?h.call(this,t):"left"==i&&n.call(this,t),this._nextAction=null}this._mesh.position.x=this._x,this._mesh.position.y=this._y,this._mesh.position.z=this._z,this._mesh.rotation.y=this._angle},s.prototype.getCol=function(){return this._castle.x2col(this._x)},s.prototype.getRow=function(){return this._castle.z2row(this._z)},s.prototype.teleport=function(t,i,s){this._action?this._nextAction={id:"teleport",x:t,y:i,z:s}:(this._action=null,this._x=t,this._y=i,this._z=s)},s.prototype.forward=function(){this._nextAction={id:"forward"}},s.prototype.right=function(){this._nextAction={id:"right"}},s.prototype.left=function(){this._nextAction={id:"left"}},s.prototype.stop=function(){this._nextAction=null},i.exports=s});
//# sourceMappingURL=mover.js.map