require("geo.castle",function(t,e){"use strict";function s(){var t,e,s,i,a,r,d,o,c;for(t=0;t<this._castle.rows;t++)for(a=t-this._castle.rows/2,e=this._castle.cols-1;e>=0;e--)s=this.getH(e,t),console.info("[geo.castle] h=...",s),i=e-this._castle.cols/2,r=s>.3+this.getH(e+1,t),d=s>.3+this.getH(e-1,t),o=s>.3+this.getH(e,t+1),c=s>.3+this.getH(e,t-1),r&&(this.addQuad({materialIndex:1,vertices:[[i+.5,s-.1,a-.5],[i+.5,s-.1,a+.5],[i+.7,s+.2,a+.5],[i+.7,s+.2,a-.5]],uvs:[[1,0],[0,0],[0,.3],[1,.3]]}),this.addQuad({materialIndex:1,vertices:[[i+.5,s-0,a-.5],[i+.5,s+.2,a-.5],[i+.5,s+.2,a+.5],[i+.5,s-0,a+.5]],uvs:[[1,0],[1,.2],[0,.2],[0,0]]}),this.addQuad({materialIndex:1,vertices:[[i+.7,s+.2,a+.5],[i+.5,s+.2,a+.5],[i+.5,s+.2,a-.5],[i+.7,s+.2,a-.5]],uvs:[[1,0],[1,.2],[0,.2],[0,0]]}),this.addTri({materialIndex:1,vertices:[[i+.5,s-.1,a+.5],[i+.7,s+.2,a+.5],[i+.5,s+.2,a+.5]],uvs:[[.2,s-.1],[0,s+.2],[.2,s+.2]]}),this.addTri({materialIndex:1,vertices:[[i+.5,s-.1,a-.5],[i+.5,s+.2,a-.5],[i+.7,s+.2,a-.5]],uvs:[[.2,s-.1],[.2,s+.2],[0,s+.2]]})),d&&(this.addQuad({materialIndex:1,vertices:[[i-.5,s-.1,a+.5],[i-.5,s-.1,a-.5],[i-.7,s+.2,a-.5],[i-.7,s+.2,a+.5]],uvs:[[1,0],[0,0],[0,.3],[1,.3]]}),this.addQuad({materialIndex:1,vertices:[[i-.5,s-0,a+.5],[i-.5,s+.2,a+.5],[i-.5,s+.2,a-.5],[i-.5,s-0,a-.5]],uvs:[[1,0],[1,.2],[0,.2],[0,0]]}),this.addQuad({materialIndex:1,vertices:[[i-.7,s+.2,a-.5],[i-.5,s+.2,a-.5],[i-.5,s+.2,a+.5],[i-.7,s+.2,a+.5]],uvs:[[1,0],[1,.2],[0,.2],[0,0]]}),this.addTri({materialIndex:1,vertices:[[i-.5,s-.1,a-.5],[i-.7,s+.2,a-.5],[i-.5,s+.2,a-.5]],uvs:[[.2,s-.1],[0,s+.2],[.2,s+.2]]}),this.addTri({materialIndex:1,vertices:[[i-.5,s-.1,a+.5],[i-.5,s+.2,a+.5],[i-.7,s+.2,a+.5]],uvs:[[.2,s-.1],[.2,s+.2],[0,s+.2]]}))}var i=require("geo"),a=function(t){i.call(this),this._castle=t,t.heights.forEach(function(e,s){if(!(1>e)){var i=s%t.cols,a=(s-i)/t.rows,r=i-t.cols/2,d=e,o=a-t.rows/2;this.addQuad({vertices:[[r-.5,d,o-.5],[r+.5,d,o-.5],[r+.5,d,o+.5],[r-.5,d,o+.5]]})}},this);var e,a,r,d,o,c,h=t.rows,u=t.cols;for(e=0;h>e;e++)for(r=0,c=e-h/2,a=0;u>a;a++)d=t.heights[a+e*u],o=a-u/2,d>r&&this.addQuad({materialIndex:1,vertices:[[o-.5,r,c+.5],[o-.5,r,c-.5],[o-.5,d,c-.5],[o-.5,d,c+.5]],uvs:[[1,r],[0,r],[0,d],[1,d]]}),r=d;for(e=0;h>e;e++)for(r=0,c=e-h/2,a=u-1;a>=0;a--)d=t.heights[a+e*u],o=a-u/2,d>r&&this.addQuad({materialIndex:1,vertices:[[o+.5,r,c-.5],[o+.5,r,c+.5],[o+.5,d,c+.5],[o+.5,d,c-.5]],uvs:[[1,r],[0,r],[0,d],[1,d]]}),r=d;for(a=0;u>a;a++)for(r=0,o=a-u/2,e=0;h>e;e++)d=t.heights[a+e*u],c=e-h/2,d>r&&this.addQuad({materialIndex:1,vertices:[[o+.5,r,c-.5],[o+.5,d,c-.5],[o-.5,d,c-.5],[o-.5,r,c-.5]],uvs:[[1,r],[1,d],[0,d],[0,r]]}),r=d;for(a=0;u>a;a++)for(r=0,o=a-u/2,e=h-1;e>=0;e--)d=t.heights[a+e*u],c=e-h/2,d>r&&this.addQuad({materialIndex:1,vertices:[[o+.5,r,c+.5],[o-.5,r,c+.5],[o-.5,d,c+.5],[o+.5,d,c+.5]],uvs:[[1,r],[0,r],[0,d],[1,d]]}),r=d;s.call(this)};a.prototype=Object.create(i.prototype),a.prototype.constructor=i,a.prototype.getH=function(t,e){var s=this._castle;return 0>t||0>e||t>=s.cols||e>=s.rows?0:s.heights[t+e*s.cols]},e.exports=a});
//# sourceMappingURL=geo.castle.js.map