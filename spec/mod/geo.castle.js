require("geo.castle",function(t,i){"use strict";function s(){var t,i,s,h,e,a,r,f,o,u,l=this._castle;for(t=0;t<this._castle.rows;t++)for(a=l.row2z(t),i=this._castle.cols-1;i>=0;i--)s=this.getH(i,t),e=s,h=l.col2x(i),r=s>.33+this.getH(i+1,t),f=s>.33+this.getH(i-1,t),o=s>.33+this.getH(i,t+1),u=s>.33+this.getH(i,t-1),r&&c.call(this,h,e,a,0),o&&c.call(this,h,e,a,1),f&&c.call(this,h,e,a,2),u&&c.call(this,h,e,a,3),r&&o&&d.call(this,h,e,a,0),o&&f&&d.call(this,h,e,a,1),f&&u&&d.call(this,h,e,a,2),u&&r&&d.call(this,h,e,a,3)}function h(t,i,s){return s}function e(t,i,s){var h=[];return s.forEach(function(s){h.push([t+i-s[2],s[1],i-t+s[0]])}),h}function a(t,i,s){var h=[];return s.forEach(function(s){h.push([2*t-s[0],s[1],2*i-s[2]])}),h}function r(t,i,s){var h=[];return s.forEach(function(s){h.push([t-i+s[2],s[1],i+t-s[0]])}),h}function d(t,i,s,h){var e=u[h];this.addTri({materialIndex:1,vertices:e(t,s,[[t+.5,i-.1,s+.5],[t+.7,i+.2,s+.5],[t+.5,i+.2,s+.7]]),uvs:[[t+.6,i-.1],[t+.7,i+.2],[t+.5,i+.2]]}),this.addQuad({materialIndex:1,vertices:e(t,s,[[t+.7,i+.2,s+.5],[t+.5,i+.2,s+.7],[t+.5,i+.4,s+.7],[t+.7,i+.4,s+.5]]),uvs:[[t+.7,i+.2],[t+.5,i+.2],[t+.5,i+.4],[t+.7,i+.4]]}),this.addTri({materialIndex:1,vertices:e(t,s,[[t+.7,i+.4,s+.5],[t+.5,i+.4,s+.5],[t+.5,i+.4,s+.7]]),uvs:[[t+.7,s+.5],[t+.5,s+.5],[t+.5,s+.7]]})}function c(t,i,s,h){var e=u[h];this.addQuad({materialIndex:1,vertices:e(t,s,[[t+.5,i-.1,s-.5],[t+.5,i-.1,s+.5],[t+.7,i+.2,s+.5],[t+.7,i+.2,s-.5]]),uvs:[[1,0],[0,0],[0,.3],[1,.3]]}),this.addQuad({materialIndex:1,vertices:e(t,s,[[t+.5,i-0,s-.5],[t+.5,i+.2,s-.5],[t+.5,i+.2,s+.5],[t+.5,i-0,s+.5]]),uvs:[[1,0],[1,.2],[0,.2],[0,0]]}),this.addQuad({materialIndex:1,vertices:e(t,s,[[t+.7,i+.2,s+.5],[t+.5,i+.2,s+.5],[t+.5,i+.2,s-.5],[t+.7,i+.2,s-.5]]),uvs:[[1,0],[1,.2],[0,.2],[0,0]]}),this.addTri({materialIndex:1,vertices:e(t,s,[[t+.5,i-.1,s+.5],[t+.7,i+.2,s+.5],[t+.5,i+.2,s+.5]]),uvs:[[.2,i-.1],[0,i+.2],[.2,i+.2]]}),this.addTri({materialIndex:1,vertices:e(t,s,[[t+.5,i-.1,s-.5],[t+.5,i+.2,s-.5],[t+.7,i+.2,s-.5]]),uvs:[[.2,i-.1],[.2,i+.2],[0,i+.2]]}),[{shift:-.5,width:.15},{shift:-.15,width:.3},{shift:.35,width:.15}].forEach(function(h){this.addQuad({materialIndex:1,vertices:e(t,s,[[t+.5,i+.2,s+h.shift+h.width],[t+.5,i+.2,s+h.shift],[t+.5,i+.4,s+h.shift],[t+.5,i+.4,s+h.shift+h.width]]),uvs:[[i+.2,s+h.shift],[i+.4,s+h.shift],[i+.4,s+h.shift+h.width],[i+.2,s+h.shift+h.width]]}),this.addQuad({materialIndex:1,vertices:e(t,s,[[t+.7,i+.2,s+h.shift+h.width],[t+.7,i+.4,s+h.shift+h.width],[t+.7,i+.4,s+h.shift],[t+.7,i+.2,s+h.shift]]),uvs:[[i+.2,s+h.shift],[i+.4,s+h.shift],[i+.4,s+h.shift+h.width],[i+.2,s+h.shift+h.width]]}),this.addQuad({materialIndex:1,vertices:e(t,s,[[t+.7,i+.4,s+h.shift+h.width],[t+.5,i+.4,s+h.shift+h.width],[t+.5,i+.4,s+h.shift],[t+.7,i+.4,s+h.shift]]),uvs:[[i+.2,s+h.shift],[i+.4,s+h.shift],[i+.4,s+h.shift+h.width],[i+.2,s+h.shift+h.width]]}),this.addQuad({materialIndex:1,vertices:e(t,s,[[t+.7,i+.2,s+h.shift],[t+.7,i+.4,s+h.shift],[t+.5,i+.4,s+h.shift],[t+.5,i+.2,s+h.shift]]),uvs:[[t+.7,i+.2],[t+.7,i+.4],[t+.5,i+.4],[t+.5,i+.2]]}),this.addQuad({materialIndex:1,vertices:e(t,s,[[t+.7,i+.2,s+h.shift+h.width],[t+.5,i+.2,s+h.shift+h.width],[t+.5,i+.4,s+h.shift+h.width],[t+.7,i+.4,s+h.shift+h.width]]),uvs:[[t+.7,i+.2],[t+.5,i+.2],[t+.5,i+.4],[t+.7,i+.4]]})},this)}var f=require("geo"),o=function(t){f.call(this),this._castle=t,t.heights.forEach(function(i,s){if(!(1>i)){var h=s%t.cols,e=(s-h)/t.cols,a=t.col2x(h),r=i,d=t.row2z(e);this.addQuad({vertices:[[a-.5,r,d-.5],[a+.5,r,d-.5],[a+.5,r,d+.5],[a-.5,r,d+.5]]})}},this);var i,h,e,a,r,d,c=t.rows,o=t.cols;for(i=0;c>i;i++)for(e=0,d=t.row2z(i),h=0;o>h;h++)a=t.getHeight(h,i),r=t.col2x(h),a>e&&this.addQuad({materialIndex:1,vertices:[[r-.5,e,d+.5],[r-.5,e,d-.5],[r-.5,a,d-.5],[r-.5,a,d+.5]],uvs:[[1,e],[0,e],[0,a],[1,a]]}),e=a;for(i=0;c>i;i++)for(e=0,d=t.row2z(i),h=o-1;h>=0;h--)a=t.heights[h+i*o],r=t.col2x(h),a>e&&this.addQuad({materialIndex:1,vertices:[[r+.5,e,d-.5],[r+.5,e,d+.5],[r+.5,a,d+.5],[r+.5,a,d-.5]],uvs:[[1,e],[0,e],[0,a],[1,a]]}),e=a;for(h=0;o>h;h++)for(e=0,r=t.col2x(h),i=0;c>i;i++)a=t.heights[h+i*o],d=t.row2z(i),a>e&&this.addQuad({materialIndex:1,vertices:[[r+.5,e,d-.5],[r+.5,a,d-.5],[r-.5,a,d-.5],[r-.5,e,d-.5]],uvs:[[1,e],[1,a],[0,a],[0,e]]}),e=a;for(h=0;o>h;h++)for(e=0,r=t.col2x(h),i=c-1;i>=0;i--)a=t.heights[h+i*o],d=t.row2z(i),a>e&&this.addQuad({materialIndex:1,vertices:[[r+.5,e,d+.5],[r-.5,e,d+.5],[r-.5,a,d+.5],[r+.5,a,d+.5]],uvs:[[1,e],[0,e],[0,a],[1,a]]}),e=a;s.call(this)};o.prototype=Object.create(f.prototype),o.prototype.constructor=f,o.prototype.getH=function(t,i){var s=this._castle;return s.getHeight(t,i)};var u=[h,e,a,r];i.exports=o});
//# sourceMappingURL=geo.castle.js.map